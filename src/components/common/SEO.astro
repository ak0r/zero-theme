---
import type { SEOData } from '@/types';
import { siteConfig } from '@/site.config';
import { generateRobotsMeta } from '@/utils/seo';

interface Props {
  data: SEOData;
}

const { data } = Astro.props;

const robotsMeta = generateRobotsMeta(data.noIndex);

// Extract Twitter handle from social links if available
const twitterLink = siteConfig.navigation.social?.find(s => 
  s.title.toLowerCase() === 'x' || s.title.toLowerCase() === 'twitter'
);
const twitterHandle = twitterLink?.url.split('/').pop();
---

<!-- Primary Meta Tags -->
<title>{data.title}</title>
<meta name="title" content={data.title} />
<meta name="description" content={data.description} />
<link rel="canonical" href={data.canonical} />

<!-- Robots -->
<meta name="robots" content={robotsMeta} />

<!-- Keywords -->
{data.keywords && data.keywords.length > 0 && (
  <meta name="keywords" content={data.keywords.join(', ')} />
)}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={data.ogType} />
<meta property="og:url" content={data.canonical} />
<meta property="og:title" content={data.title} />
<meta property="og:description" content={data.description} />
{data.ogImage && (
  <>
    <meta property="og:image" content={data.ogImage.url} />
    <meta property="og:image:alt" content={data.ogImage.alt} />
    <meta property="og:image:width" content={data.ogImage.width.toString()} />
    <meta property="og:image:height" content={data.ogImage.height.toString()} />
  </>
)}
<meta property="og:site_name" content={siteConfig.title} />
<meta property="og:locale" content={siteConfig.language || 'en'} />

<!-- Article specific -->
{data.ogType === 'article' && (
  <>
    {data.publishedTime && <meta property="article:published_time" content={data.publishedTime} />}
    {data.modifiedTime && <meta property="article:modified_time" content={data.modifiedTime} />}
    <meta property="article:author" content={siteConfig.author} />
    {data.tags && data.tags.map(tag => <meta property="article:tag" content={tag} />)}
  </>
)}

<!-- Twitter -->
<meta name="twitter:card" content={data.twitter?.card || 'summary_large_image'} />
<meta name="twitter:url" content={data.canonical} />
<meta name="twitter:title" content={data.twitter?.title || data.title} />
<meta name="twitter:description" content={data.twitter?.description || data.description} />
{data.twitter?.image && <meta name="twitter:image" content={data.twitter.image} />}
{twitterHandle && <meta name="twitter:site" content={`@${twitterHandle}`} />}
{twitterHandle && data.ogType === 'article' && (
  <meta name="twitter:creator" content={`@${twitterHandle}`} />
)}

<!-- Additional Meta Tags -->
<meta name="theme-color" content="#ffffff" />
<meta name="color-scheme" content="light dark" />

<!-- JSON-LD Schema for Articles -->
{data.ogType === 'article' && (
  <script type="application/ld+json" set:html={JSON.stringify({
    '@context': 'https://schema.org',
    '@type': 'BlogPosting',
    headline: data.title,
    description: data.description,
    image: data.ogImage?.url,
    datePublished: data.publishedTime,
    dateModified: data.modifiedTime || data.publishedTime,
    author: {
      '@type': 'Person',
      name: siteConfig.author,
    },
    publisher: {
      '@type': 'Organization',
      name: siteConfig.title,
      logo: {
        '@type': 'ImageObject',
        url: new URL('/logo.png', siteConfig.siteURL).href,
      },
    },
    mainEntityOfPage: {
      '@type': 'WebPage',
      '@id': data.canonical,
    },
    keywords: data.keywords?.join(', '),
  })} />
)}

<!-- JSON-LD Schema for Website -->
{data.ogType === 'website' && (
  <script type="application/ld+json" set:html={JSON.stringify({
    '@context': 'https://schema.org',
    '@type': 'WebSite',
    name: siteConfig.title,
    description: siteConfig.description,
    url: siteConfig.siteURL,
    author: {
      '@type': 'Person',
      name: siteConfig.author,
    },
  })} />
)}