---
import { getAllGalleries, sortGalleriesByDate, getGalleriesByTag, getUniqueGalleryTags } from '@/utils/getGallery';
import type { GetStaticPaths } from 'astro';
import BaseLayout from '@/layouts/BaseLayout.astro';
import Container from '@/components/layout/ContainerWrapper.astro';
import SEO from '@/components/common/SEO.astro';
import GalleryGrid from '@/components/gallery/GalleryGrid.astro';
import Breadcrumbs from '@/components/widgets/Breadcrumbs.astro';
import { getBreadcrumbsFromPath } from '@/utils/breadcrumbs';


export const getStaticPaths = (async () => {
  const galleries = await getAllGalleries();
  const tags = getUniqueGalleryTags(galleries);
  
  return tags.map((tag) => {
    const taggedGalleries = getGalleriesByTag(galleries, tag);
    const sorted = sortGalleriesByDate(taggedGalleries);
    
    return {
      params: { tag },
      props: { tag, galleries: sorted },
    };
  });
}) satisfies GetStaticPaths;

const { tag, galleries } = Astro.props;

// SEO data
const seoData = {
  title: `Gallery: ${tag}`,
  description: `Photo galleries tagged with "${tag}".`,
  canonical: Astro.url.href,
};

// Generate breadcrumbs for the page
const breadcrumbs = getBreadcrumbsFromPath(Astro.url.pathname);
---

<BaseLayout>
  <SEO data={seoData} slot="head" />
  
  <Container class="py-8">
    
    <div class="animate">
      <Breadcrumbs items={breadcrumbs} class="my-6" />
    </div>
    
    <!-- Header -->
    <div class="animate mb-12">
      <h1 class="text-4xl font-bold text-content-primary mb-4">
        Gallery: {tag}
      </h1>
      <p class="text-lg text-content-muted">
        {galleries.length} {galleries.length === 1 ? 'gallery' : 'galleries'} tagged with "{tag}"
      </p>
    </div>
    
    <!-- Galleries Grid -->
    <div class="animate">
      <GalleryGrid galleries={galleries} />
    </div>
    
  </Container>
</BaseLayout>